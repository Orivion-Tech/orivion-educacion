{"ast":null,"code":"'use strict';\n\nconst defaultTreeAdapter = require('../tree-adapters/default');\nconst mergeOptions = require('../utils/merge-options');\nconst doctype = require('../common/doctype');\nconst HTML = require('../common/html');\n\n//Aliases\nconst $ = HTML.TAG_NAMES;\nconst NS = HTML.NAMESPACES;\n\n//Default serializer options\nconst DEFAULT_OPTIONS = {\n  treeAdapter: defaultTreeAdapter\n};\n\n//Escaping regexes\nconst AMP_REGEX = /&/g;\nconst NBSP_REGEX = /\\u00a0/g;\nconst DOUBLE_QUOTE_REGEX = /\"/g;\nconst LT_REGEX = /</g;\nconst GT_REGEX = />/g;\n\n//Serializer\nclass Serializer {\n  constructor(node, options) {\n    this.options = mergeOptions(DEFAULT_OPTIONS, options);\n    this.treeAdapter = this.options.treeAdapter;\n    this.html = '';\n    this.startNode = node;\n  }\n\n  //API\n  serialize() {\n    this._serializeChildNodes(this.startNode);\n    return this.html;\n  }\n\n  //Internals\n  _serializeChildNodes(parentNode) {\n    const childNodes = this.treeAdapter.getChildNodes(parentNode);\n    if (childNodes) {\n      for (let i = 0, cnLength = childNodes.length; i < cnLength; i++) {\n        const currentNode = childNodes[i];\n        if (this.treeAdapter.isElementNode(currentNode)) {\n          this._serializeElement(currentNode);\n        } else if (this.treeAdapter.isTextNode(currentNode)) {\n          this._serializeTextNode(currentNode);\n        } else if (this.treeAdapter.isCommentNode(currentNode)) {\n          this._serializeCommentNode(currentNode);\n        } else if (this.treeAdapter.isDocumentTypeNode(currentNode)) {\n          this._serializeDocumentTypeNode(currentNode);\n        }\n      }\n    }\n  }\n  _serializeElement(node) {\n    const tn = this.treeAdapter.getTagName(node);\n    const ns = this.treeAdapter.getNamespaceURI(node);\n    this.html += '<' + tn;\n    this._serializeAttributes(node);\n    this.html += '>';\n    if (tn !== $.AREA && tn !== $.BASE && tn !== $.BASEFONT && tn !== $.BGSOUND && tn !== $.BR && tn !== $.COL && tn !== $.EMBED && tn !== $.FRAME && tn !== $.HR && tn !== $.IMG && tn !== $.INPUT && tn !== $.KEYGEN && tn !== $.LINK && tn !== $.META && tn !== $.PARAM && tn !== $.SOURCE && tn !== $.TRACK && tn !== $.WBR) {\n      const childNodesHolder = tn === $.TEMPLATE && ns === NS.HTML ? this.treeAdapter.getTemplateContent(node) : node;\n      this._serializeChildNodes(childNodesHolder);\n      this.html += '</' + tn + '>';\n    }\n  }\n  _serializeAttributes(node) {\n    const attrs = this.treeAdapter.getAttrList(node);\n    for (let i = 0, attrsLength = attrs.length; i < attrsLength; i++) {\n      const attr = attrs[i];\n      const value = Serializer.escapeString(attr.value, true);\n      this.html += ' ';\n      if (!attr.namespace) {\n        this.html += attr.name;\n      } else if (attr.namespace === NS.XML) {\n        this.html += 'xml:' + attr.name;\n      } else if (attr.namespace === NS.XMLNS) {\n        if (attr.name !== 'xmlns') {\n          this.html += 'xmlns:';\n        }\n        this.html += attr.name;\n      } else if (attr.namespace === NS.XLINK) {\n        this.html += 'xlink:' + attr.name;\n      } else {\n        this.html += attr.prefix + ':' + attr.name;\n      }\n      this.html += '=\"' + value + '\"';\n    }\n  }\n  _serializeTextNode(node) {\n    const content = this.treeAdapter.getTextNodeContent(node);\n    const parent = this.treeAdapter.getParentNode(node);\n    let parentTn = void 0;\n    if (parent && this.treeAdapter.isElementNode(parent)) {\n      parentTn = this.treeAdapter.getTagName(parent);\n    }\n    if (parentTn === $.STYLE || parentTn === $.SCRIPT || parentTn === $.XMP || parentTn === $.IFRAME || parentTn === $.NOEMBED || parentTn === $.NOFRAMES || parentTn === $.PLAINTEXT || parentTn === $.NOSCRIPT) {\n      this.html += content;\n    } else {\n      this.html += Serializer.escapeString(content, false);\n    }\n  }\n  _serializeCommentNode(node) {\n    this.html += '<!--' + this.treeAdapter.getCommentNodeContent(node) + '-->';\n  }\n  _serializeDocumentTypeNode(node) {\n    const name = this.treeAdapter.getDocumentTypeNodeName(node);\n    this.html += '<' + doctype.serializeContent(name, null, null) + '>';\n  }\n}\n\n// NOTE: used in tests and by rewriting stream\nSerializer.escapeString = function (str, attrMode) {\n  str = str.replace(AMP_REGEX, '&amp;').replace(NBSP_REGEX, '&nbsp;');\n  if (attrMode) {\n    str = str.replace(DOUBLE_QUOTE_REGEX, '&quot;');\n  } else {\n    str = str.replace(LT_REGEX, '&lt;').replace(GT_REGEX, '&gt;');\n  }\n  return str;\n};\nmodule.exports = Serializer;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}