generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Persona {
  id               String         @id @default(uuid())
  dni_pasaporte    String?        @unique
  nombres          String
  apellidos        String
  fecha_nacimiento DateTime?
  genero           String?
  metadata         Json?
  usuarios         Usuario[]
  actores          ActorDominio[]
}

model Usuario {
  id                String  @id @default(uuid())
  personaId         String
  username          String  @unique
  passwordHash      String
  dobleFactorActivo Boolean @default(false)
  persona           Persona @relation(fields: [personaId], references: [id])
}

model Institucion {
  id            String         @id @default(uuid())
  nombre        String
  ruc_tax_id    String?        @unique
  configuracion Json?
  actores       ActorDominio[]
}

model ActorDominio {
  id            String       @id @default(uuid())
  personaId     String
  institucionId String
  tipo          String
  estado        String?
  metadata      Json?
  persona       Persona      @relation(fields: [personaId], references: [id])
  institucion   Institucion  @relation(fields: [institucionId], references: [id])
  estudiantes   Estudiante[]
}

model Estudiante {
  id              String       @id @default(uuid())
  actorId         String       @unique
  codigoMatricula String?
  actor           ActorDominio @relation(fields: [actorId], references: [id])
  matriculas      Matricula[]
}

model Matricula {
  id             String         @id @default(uuid())
  estudianteId   String
  periodoId      String
  seccionId      String
  estado         String
  estudiante     Estudiante     @relation(fields: [estudianteId], references: [id])
  calificaciones Calificacion[]
}

model Calificacion {
  id          String    @id @default(uuid())
  matriculaId String
  valor       Float
  rubrica     Json?
  feedback    String?
  matricula   Matricula @relation(fields: [matriculaId], references: [id])
}

model PoliticaPrivacidad {
  id      String  @id @default(uuid())
  version String
  vigente Boolean @default(true)
}

model Consentimiento {
  id                 String    @id @default(uuid())
  personaMenorId     String
  actorResponsableId String
  otorgado           Boolean
  fechaOtorgado      DateTime?
}

model AuditoriaLog {
  id            String   @id @default(uuid())
  accion        String
  valorAnterior Json?
  valorNuevo    Json?
  creadoEn      DateTime @default(now())
}

model FeatureAprendizaje {
  id            String  @id @default(uuid())
  featureCodigo String
  valor         Float
  anonimo       Boolean @default(true)
}
